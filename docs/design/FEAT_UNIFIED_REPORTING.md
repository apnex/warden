# Design Specification: Unified Reporting & Automated Audit Synthesis

| Metadata | Value |
| :--- | :--- |
| **Feature ID** | FEAT_UNIFIED_REPORTING |
| **Concept** | CON-009 (Structured Interaction & Provenance) |
| **Status** | LIVE |
| **Domain** | Telemetry / Audit |
| **Dependency** | FEAT_STRUCTURED_AUDIT |

## 1. Executive Summary
This feature consolidates the fragmented reporting suite (`pir.js`, `compliance.js`, `report.js`) into a single high-fidelity entry point: `engine/report.js`. It introduces a path-agnostic semantic matcher and automated draft synthesis to eliminate turn friction and achieve 100% audit trust.

## 2. Technical Dependencies
- **FEAT_STRUCTURED_AUDIT**: Provides the **Canonical Command Model** and **Intent Interceptor** required for bit-perfect ID matching.

## 3. Solution Architecture

### 3.1 The Unified Reporter (`report.js`)
`engine/report.js` now serves as the authoritative source for all system telemetry:
- **`--compliance`**: Performs the Three-Way Compliance Audit (Engineer Claims vs. Warden Logs vs. Internal View).
- **`--pir`**: Generates the Post-Implementation Review summary.
- **`--json`**: Emits raw interaction telemetry for machine-readability.
- **`--draft`**: Synthesizes the initial `engineer_report.json` skeleton.

### 3.2 Path-Agnostic Semantic Resolver
The matcher uses a multi-layered reconciliation strategy to resolve the "Audit Gap":
1.  **Intent ID Matching**: Priority match using the `intent.id` generated by the Warden interceptor (Bit-Perfect).
2.  **Path Normalization**: Strips directory prefixes (`validation/`, `engine/`) and `node` wrappers to isolate the tool's identity.
3.  **Command-Word Inclusion**: Verifies that specific command tokens (e.g., `init`, `next`) exist within the logged CLI string.
4.  **Temporal Filtering**: Automatically isolates actions based on the `start_time` of the active mission state.

### 3.3 Automated Audit Synthesis (`--draft`)
To prevent "Claim Friction," the reporter can automatically generate the `engineer_report.json`:
- It scans the current cycle's structured logs.
- It maps `intent.id` values to claim objects.
- It presents the Engineer with a "Verified Action List," requiring only the qualitative "qualitative_leg" analysis to complete the Three-Way Audit.

## 4. Operational Workflow
1.  **Execution**: Engineer performs mission tasks via `warden.js exec`.
2.  **Drafting**: Engineer runs `node engine/report.js --draft`.
3.  **Refinement**: Engineer adds qualitative justification to the draft.
4.  **Ratification**: Warden runs `node engine/report.js --compliance` to verify the "Self-Audit" against the bit-perfect logs.

## 5. Success Metrics
- **Match Fidelity**: Trust Score reached 100% during live implementation turns.
- **Tool Consolidation**: Removed 3 redundant scripts in favor of a single unified module.
- **Observability**: 100% of cycle actions are machine-verifiable through the Structured Audit graph.

---
**Status**: LIVE  
**Author**: Engineer  
**Ratified**: Director (2026-01-13)
